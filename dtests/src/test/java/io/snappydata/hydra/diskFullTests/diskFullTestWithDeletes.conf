hydra.Prms-testRequirement = "Test to verify the cluster stability while delete operations are being executed during diskfull scenario";
hydra.Prms-testDescription = "This test starts the snappy cluster.
    Creates column tables with key columns . After initialization,data is ingested in the cluster using inserts.
    Then batch delete operations are executed, in parallel to the deletion task, we also execute fallocate command to
    create files of specific size in order to create the disk full situation.
    In closeTask, the cluster is shutdown ,the pre created files are cleared, so as to free up disk space.
    Then the cluster is started and validation is done to check if cluster is up and running and that there is no data loss";

INCLUDE $JTESTS/io/snappydata/hydra/northwind/startEmbeddedModeCluster.conf;
//create and load tables
INITTASK    taskClass   = io.snappydata.hydra.cluster.SnappyTest taskMethod  = HydraTask_executeSQLScripts
            io.snappydata.hydra.cluster.SnappyPrms-sqlScriptNames = ${scriptName}
            threadGroups = snappyThreads
            ;

INITTASK    taskClass   = io.snappydata.hydra.cdcConnector.SnappyCDCTest taskMethod  = HydraTask_executeFallocate
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-fileSize = ${fileSize}
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-snappyFileLoc = ${snappyFileLoc}
            threadGroups = snappyThreads
            ;

INITTASK    taskClass  = io.snappydata.hydra.cdcConnector.SnappyCDCTest taskMethod  = HydraTask_executeOps
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-snappyFileLoc = ${snappyFileLoc}
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-dataLocation = ${deleteQueryFilePath}
            threadGroups = leadThreads
            ;

CLOSETASK   taskClass  = io.snappydata.hydra.cdcConnector.SnappyCDCTest taskMethod  = HydraTask_executeCleanUpFiles
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-snappyFileLoc = ${snappyFileLoc}
            threadGroups = snappyThreads
            ;


/*
//Execute continuous ingest operation in batch .
TASK        taskClass  = io.snappydata.hydra.cdcConnector.SnappyCDCTest taskMethod  = HydraTask_executeOps
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-snappyFileLoc = ${snappyFileLoc}
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-dataLocation = ${insertQueryFilePath}
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-tableType = ${tableType}
            maxTimesToRun = 5
            threadGroups = snappyThreads;

//Execute delete operation in batch .
TASK        taskClass  = io.snappydata.hydra.cdcConnector.SnappyCDCTest taskMethod  = HydraTask_executeOps
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-snappyFileLoc = ${snappyFileLoc}
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-tableType = ${tableType}
            io.snappydata.hydra.testDMLOps.SnappySchemaPrms-dmlOperations = delete
            startInterval = 110
            endInterval   = 110
            maxThreads = 1
            maxTimesToRun = 1
            threadGroups = leadThreads;

//Execute fallocate in parallel to the ingestion task.
TASK        taskClass   = io.snappydata.hydra.cdcConnector.SnappyCDCTest taskMethod  = HydraTask_executeFallocate
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-fileSize = ${fileSize}
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-snappyFileLoc = ${snappyFileLoc}
            maxThreads = 1
            maxTimesToRun = 3
            startInterval = 60
            endInterval   = 60
            threadGroups = locatorThreads
            ;*/



CLOSETASK   taskClass  = io.snappydata.hydra.cdcConnector.SnappyCDCTest taskMethod  = HydraTask_executeCleanUpFiles
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-snappyFileLoc = ${snappyFileLoc}
            io.snappydata.hydra.cdcConnector.SnappyCDCPrms-tableType = ${tableType}
            threadGroups = snappyThreads;


// INCLUDE $JTESTS/io/snappydata/hydra/northwind/stopEmbeddedModeCluster.conf;

hydra.Prms-totalTaskTimeSec           = 1200;
hydra.Prms-maxResultWaitSec           = 1200;
io.snappydata.hydra.cluster.SnappyPrms-serverMemory = 4g;

